<% provide :title, "Manage Users" %>

<h2 class="text-center">Manage Users</h2>

<div class="col-md-12">
  <div class="row">
    <div class="col-md-2">
      <div class="row">
        <% if current_user.admin? %>
          <%= link_to new_admin_user_path, class: "btn btn-primary btn-sm" do %>
            <span class="glyphicon glyphicon-plus"></span> New User
          <% end %>
        <% end %>
      </div>
    </div>

    <div class="col-md-6 col-md-offset-1">
      <%= form_tag admin_users_path, method: :get do %>
        <%= text_field_tag :search, params[:search], class: "form-control",
          placeholder: "Search by name, email or github account" %>
      <% end %>
    </div>
  </div>
</div>

<div class="stats col-md-12">
  <div class="row">
    <div class="col-md-2 row">
      <span class="amount">Total: <%= @support.total_users %></span>
    </div>

    <div class="col-md-8 detail-stats">
      <span class="admin-user">admin: <%= @support.number_of_admins %></span>
      <span class="trainer-user">trainer: <%= @support.number_of_trainers %></span>
      <span class="supporter-user">supporter: <%= @support.number_of_supporters %></span>
      <span class="normal-user">normal: <%= @support.number_of_normal_users %></span>
    </div>
  </div>
</div>

<table class="table table-hover table-striped">
  <thead>
    <tr>
      <th class="index">#</th>
      <th>Name</th>
      <th>Email</th>
      <th>Github Account</th>
      <th>Office</th>
      <th>Number of Pull requests</th>
      <th class="role">Role</th>
      <% if current_user.admin? %>
        <th>Action</th>
      <% end %>
    </tr>
  </thead>
  <tbody>
    <% @users.each_with_index do |user, index| %>
      <tr>
        <td>
          <%= index_for params[:page] || 1, index, Settings.admin.user.per_page %>
        </td>
        <td><%= link_to user.name, admin_user_path(user) %></td>
        <td><%= user.email %></td>
        <td><%= user.github_account %></td>
        <td>
          <% if user.office_name %>
            <%= user.office_name %>
          <% else %>
            <span class="admin-non-office-user">N/A</span>
          <% end %>
        </td>
        <td><%= user.pull_requests.size %></td>
        <td>
          <span class="<%= user.role if user.role != 'normal' %>-user"><%= user.role %></span>
        </td>
        <% if current_user.admin? %>
          <td>
            <%= link_to edit_admin_user_path(user), title: "Edit",
              class: "btn btn-warning btn-xs" do %>
              <span class="glyphicon glyphicon-edit"></span>
            <% end %>
            <% unless current_user? user %>
              <%= link_to admin_user_path(user), method: :delete, title: "Delete",
                class: "btn btn-danger btn-xs", data: {confirm: "Are you sure?"} do %>
                <span class="glyphicon glyphicon-trash"></span>
              <% end %>
            <% end %>
          </td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<div class="text-center">
  <%= paginate @users, left: 2, right: 3, theme: "twitter-bootstrap-4",
    pagination_class: "pagination-sm" %>
</div>
